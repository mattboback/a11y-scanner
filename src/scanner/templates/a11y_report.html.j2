<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{ model.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0a0e1a;
      --bg-gradient: radial-gradient(ellipse 1400px 900px at 50% 0%, #0f1828 0%, #0a0e1a 60%);
      --panel: #0f1419;
      --card: #0d1117;
      --card-hover: #161b22;
      --text: #e6edf3;
      --text-secondary: #7d8590;
      --text-muted: #6e7681;
      --accent: #58a6ff;
      --accent-muted: #1f6feb;
      --ok: #3fb950;
      --warn: #d29922;
      --bad: #f85149;
      --critical: #ff4444;
      --serious: #ff8c00;
      --moderate: #ffa500;
      --minor: #ffd700;
      --border: #21262d;
      --border-muted: #30363d;
      --code-bg: #0d1117;
      --code-border: #21262d;
      --shadow: rgba(1,4,9,0.5);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      background-image: var(--bg-gradient);
      background-attachment: fixed;
      color: var(--text);
      line-height: 1.6;
      padding: 1.5rem;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 8px 32px var(--shadow);
      position: sticky;
      top: 1rem;
      z-index: 100;
      backdrop-filter: blur(12px);
      background: rgba(13, 17, 23, 0.95);
    }

    h1 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text);
      letter-spacing: -0.03em;
    }

    .meta {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 16px var(--shadow);
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .kpi {
      background: var(--panel);
      border: 1px solid var(--border-muted);
      border-radius: 10px;
      padding: 1.25rem;
      transition: all 0.2s ease;
    }

    .kpi:hover {
      border-color: var(--accent-muted);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(88, 166, 255, 0.1);
    }

    .kpi .label {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .kpi .value {
      font-size: 2.5rem;
      font-weight: 700;
      line-height: 1;
    }

    .status-ok { color: var(--ok); }
    .status-warn { color: var(--warn); }
    .status-bad { color: var(--bad); }

    .raw-files {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }

    .raw-files-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .raw-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .raw-list a {
      display: inline-flex;
      align-items: center;
      background: var(--panel);
      border: 1px solid var(--border-muted);
      color: var(--accent);
      padding: 0.375rem 0.75rem;
      border-radius: 6px;
      font-size: 0.8125rem;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
      text-decoration: none;
      transition: all 0.15s ease;
    }

    .raw-list a:hover {
      background: var(--card-hover);
      border-color: var(--accent);
    }

    .artifact-note {
      color: var(--text-muted);
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }

    .severity-summary {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }

    .severity-title {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-bottom: 0.75rem;
    }

    .severity-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .severity-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: 1px solid var(--border-muted);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: capitalize;
      background: rgba(88, 166, 255, 0.1);
      color: var(--text);
    }

    .severity-chip .count {
      font-variant-numeric: tabular-nums;
      color: var(--accent);
    }

    .impact-critical.severity-chip {
      background: rgba(255, 68, 68, 0.15);
      border-color: rgba(255, 68, 68, 0.4);
      color: var(--critical);
    }

    .impact-serious.severity-chip {
      background: rgba(255, 140, 0, 0.15);
      border-color: rgba(255, 140, 0, 0.35);
      color: var(--serious);
    }

    .impact-moderate.severity-chip {
      background: rgba(255, 165, 0, 0.15);
      border-color: rgba(255, 165, 0, 0.3);
      color: var(--moderate);
    }

    .impact-minor.severity-chip {
      background: rgba(255, 215, 0, 0.15);
      border-color: rgba(255, 215, 0, 0.3);
      color: var(--minor);
    }

    .impact-unknown.severity-chip {
      background: rgba(125, 133, 144, 0.15);
      border-color: rgba(125, 133, 144, 0.3);
      color: var(--text-secondary);
    }

    .page-table {
      display: grid;
      gap: 0.75rem;
    }

    .page-row {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto minmax(0, 1.5fr);
      gap: 1rem;
      align-items: center;
      padding: 0.75rem 0.9rem;
      border: 1px solid var(--border-muted);
      border-radius: 8px;
      background: var(--card);
    }

    .page-row.header {
      background: transparent;
      border: none;
      padding: 0;
      color: var(--text-secondary);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .page-name {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .page-label {
      font-weight: 600;
      color: var(--text);
      overflow-wrap: anywhere;
    }

    .page-name a {
      color: var(--accent);
      font-size: 0.8rem;
      text-decoration: none;
    }

    .page-name a:hover {
      text-decoration: underline;
    }

    .page-total {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 52px;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-weight: 700;
      background: rgba(88, 166, 255, 0.15);
      border: 1px solid rgba(88, 166, 255, 0.3);
      color: var(--accent);
      font-variant-numeric: tabular-nums;
    }

    .page-impacts {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .rules {
      display: grid;
      gap: 1.5rem;
    }

    .rule {
      background: var(--panel);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 1.75rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .rule:hover {
      border-color: var(--accent-muted);
      box-shadow: 0 16px 32px rgba(10, 15, 25, 0.45);
    }

    .impact-critical {
      border-left: 4px solid var(--critical);
    }

    .impact-serious {
      border-left: 4px solid var(--serious);
    }

    .impact-moderate {
      border-left: 4px solid var(--moderate);
    }

    .impact-minor {
      border-left: 4px solid var(--minor);
    }

    .rule-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.25rem;
    }

    .rule-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .rule-id {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text);
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    }

    .rule-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge-impact {
      background: rgba(248, 113, 113, 0.18);
      color: var(--bad);
      border: 1px solid rgba(248, 113, 113, 0.35);
    }

    .impact-critical .badge-impact {
      background: rgba(255, 68, 68, 0.18);
      color: var(--critical);
      border: 1px solid rgba(255, 68, 68, 0.45);
    }

    .impact-serious .badge-impact {
      background: rgba(255, 140, 0, 0.18);
      color: var(--serious);
      border: 1px solid rgba(255, 140, 0, 0.4);
    }

    .impact-moderate .badge-impact {
      background: rgba(255, 165, 0, 0.18);
      color: var(--moderate);
      border: 1px solid rgba(255, 165, 0, 0.35);
    }

    .impact-minor .badge-impact {
      background: rgba(255, 215, 0, 0.18);
      color: var(--minor);
      border: 1px solid rgba(255, 215, 0, 0.35);
    }

    .badge-count {
      background: rgba(88, 166, 255, 0.16);
      color: var(--accent);
      border: 1px solid rgba(88, 166, 255, 0.35);
    }

    .badge-link {
      background: rgba(88, 166, 255, 0.1);
      color: var(--accent);
      border: 1px solid var(--border-muted);
      text-decoration: none;
      transition: all 0.15s ease;
    }

    .badge-link:hover {
      background: rgba(88, 166, 255, 0.22);
      border-color: var(--accent);
    }

    .rule-meta {
      display: grid;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .rule-desc {
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .rule-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .rule-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.25rem 0.65rem;
      border-radius: 999px;
      background: rgba(125, 133, 144, 0.18);
      color: var(--text-secondary);
      font-size: 0.75rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .occ-groups {
      display: grid;
      gap: 1.1rem;
    }

    .occ-group {
      background: var(--card);
      border: 1px solid var(--border-muted);
      border-radius: 10px;
      padding: 1.25rem;
      display: grid;
      gap: 1rem;
    }

    .occ-list {
      display: grid;
      gap: 0.75rem;
    }

    .occ-group-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .occ-header-left {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .occ-page {
      font-weight: 600;
      color: var(--text);
      word-break: break-word;
    }

    .occ-links {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      font-size: 0.8rem;
    }

    .occ-link {
      color: var(--accent);
      text-decoration: none;
      border: 1px solid transparent;
      padding: 0.2rem 0.45rem;
      border-radius: 4px;
      background: rgba(88, 166, 255, 0.08);
      transition: all 0.2s ease;
    }

    .occ-link:hover {
      border-color: rgba(88, 166, 255, 0.4);
      background: rgba(88, 166, 255, 0.18);
    }

    .occ-count {
      background: rgba(88, 166, 255, 0.12);
      border: 1px solid rgba(88, 166, 255, 0.28);
      color: var(--accent);
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    details.occ {
      background: var(--panel);
      border: 1px solid var(--border-muted);
      border-radius: 8px;
      padding: 0.9rem 1rem;
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    details.occ[open] {
      background: var(--card-hover);
      border-color: var(--accent-muted);
      box-shadow: 0 8px 24px rgba(15, 21, 37, 0.35);
    }

    details.occ summary {
      cursor: pointer;
      list-style: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
    }

    details.occ summary::-webkit-details-marker {
      display: none;
    }

    .occ-summary {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .occ-summary code {
      background: var(--code-bg);
      border: 1px solid var(--code-border);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      color: #80c7ff;
    }

    .occ-missing {
      color: var(--text-muted);
      font-style: italic;
    }

    .occ-pill {
      background: rgba(125, 133, 144, 0.25);
      border-radius: 999px;
      padding: 0.2rem 0.6rem;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .occ-body {
      margin-top: 0.85rem;
      display: grid;
      gap: 0.9rem;
      font-size: 0.875rem;
    }

    .occ-meta {
      display: grid;
      gap: 0.5rem;
    }

    .occ-meta-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .occ-label {
      color: var(--text-muted);
      font-weight: 600;
      min-width: 70px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.7rem;
    }

    .occ-value {
      color: var(--text);
      word-break: break-word;
    }

    .occ-value code {
      background: var(--code-bg);
      border: 1px solid var(--code-border);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
      font-size: 0.75rem;
      color: #79c0ff;
    }

    .occ-value a {
      color: var(--accent);
      text-decoration: none;
    }

    .occ-value a:hover {
      text-decoration: underline;
    }

    .snippet-label {
      color: var(--text-muted);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .snippet {
      display: grid;
      gap: 0.4rem;
    }

    .why {
      display: grid;
      gap: 0.4rem;
    }

    pre {
      background: var(--code-bg);
      border: 1px solid var(--code-border);
      border-radius: 6px;
      padding: 0.75rem;
      overflow-x: auto;
      font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
      font-size: 0.8125rem;
      line-height: 1.5;
    }

    pre code {
      color: #e6edf3;
      background: none;
      border: none;
      padding: 0;
    }

    .why-list {
      list-style: none;
      display: grid;
      gap: 0.35rem;
      padding-left: 0;
      margin: 0;
    }

    .why-list li {
      position: relative;
      padding-left: 1rem;
      color: var(--text);
      line-height: 1.4;
    }

    .why-list li::before {
      content: "•";
      position: absolute;
      left: 0;
      color: var(--accent);
    }

    .why-list li.why-lead {
      padding-left: 0;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .why-list li.why-lead::before {
      content: none;
    }

    .occ-screenshot {
      margin: 0;
      background: var(--code-bg);
      border: 1px solid var(--border-muted);
      border-radius: 10px;
      padding: 0.75rem;
    }

    .occ-screenshot img {
      display: block;
      max-width: 100%;
      height: auto;
      border-radius: 6px;
      border: 1px solid var(--border);
      image-rendering: crisp-edges;
      image-rendering: -webkit-optimize-contrast;
    }

    .occ-screenshot figcaption {
      margin-top: 0.5rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    footer {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }

      header {
        padding: 1.5rem;
        position: static;
      }

      h1 {
        font-size: 1.5rem;
      }

      .summary {
        grid-template-columns: 1fr;
      }

      .kpi .value {
        font-size: 2rem;
      }

      .page-row {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }

      .page-row.header {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>{{ model.title }}</h1>
      <div class="meta">
        <time datetime="{{ model.generated_at }}">{{ model.generated_at }}</time>
      </div>
    </header>

    <section class="card">
      <div class="section-title">Summary</div>
      <div class="summary">
        <div class="kpi">
          <div class="label">Pages Scanned</div>
          <div class="value"><span id="pages-scanned">{{ model.pages_scanned }}</span></div>
        </div>
        <div class="kpi">
          <div class="label">Total Violations</div>
          <div class="value {% if model.total_violations == 0 %}status-ok{% elif model.total_violations < 10 %}status-warn{% else %}status-bad{% endif %}">
            <span id="total-violations">{{ model.total_violations }}</span>
          </div>
        </div>
        <div class="kpi">
          <div class="label">Raw Artifacts</div>
          <div class="value">{{ model.raw_files|length }}</div>
        </div>
      </div>

      {% if summary_json or model.raw_files %}
      <div class="raw-files">
        <div class="raw-files-title">Artifacts</div>
        <div class="raw-list">
          {% if summary_json %}
          <a href="{{ summary_json }}" target="_blank" rel="noopener">Consolidated summary (JSON)</a>
          {% endif %}
          {% for f in model.raw_files %}
          <a href="{{ results_web_base }}/{{ f }}" target="_blank" rel="noopener">{{ f }}</a>
          {% endfor %}
        </div>
        {% if summary_json %}
        <p class="artifact-note">Includes aggregated counts, per-rule details, and page summaries.</p>
        {% endif %}
      </div>
      {% endif %}

      {% if model.total_violations > 0 %}
      <div class="severity-summary">
        <div class="severity-title">Violations by Impact</div>
        <div class="severity-chips">
          {% for impact, count in model.impact_summary.items() if count > 0 %}
            <span class="severity-chip impact-{{ impact }}">
              {{ impact.replace('_', ' ') | title }}
              <span class="count">{{ count }}</span>
            </span>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </section>

    {% if model.total_violations > 0 and model.page_summaries %}
    <section class="card">
      <div class="section-title">Pages With Violations ({{ model.page_summaries|length }})</div>
      <div class="page-table">
        <div class="page-row header">
          <div>Page</div>
          <div>Violations</div>
          <div>Impact Mix</div>
        </div>
        {% for page in model.page_summaries %}
        <div class="page-row">
          <div class="page-name">
            <span class="page-label">{{ page.label }}</span>
            {% set page_link = None %}
            {% if pages_web_base and page.source_file %}
              {% set page_link = pages_web_base ~ '/' ~ page.source_file %}
            {% elif page.url %}
              {% set page_link = page.url %}
            {% endif %}
            {% if page_link %}
            {% set link_needs_server = page.url and ('localhost' in page.url or '127.0.0.1' in page.url) and not (pages_web_base and page.source_file) %}
            <a href="{{ page_link }}" target="_blank" rel="noopener">
              {% if link_needs_server %}Open scanned URL (requires server) →{% else %}Open page →{% endif %}
            </a>
            {% endif %}
            {% if page.report_filename %}
            <a href="{{ results_web_base }}/{{ page.report_filename }}" target="_blank" rel="noopener">Raw JSON →</a>
            {% endif %}
          </div>
          <div class="page-total">{{ page.total_violations }}</div>
          <div class="page-impacts">
            {% if page.impact_counts %}
              {% for impact, count in page.impact_counts.items() %}
              <span class="severity-chip impact-{{ impact }}">
                {{ impact.replace('_', ' ') | title }}
                <span class="count">{{ count }}</span>
              </span>
              {% endfor %}
            {% else %}
              <span class="artifact-note">Impact details unavailable</span>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    {% if model.total_violations == 0 %}
    <section class="card">
      <div class="section-title">Violations</div>
      <p class="rule-desc">✅ No accessibility violations found! Great work!</p>
    </section>
    {% else %}
    <section class="card">
      <div class="section-title">Violations by Rule ({{ model.by_rule|length }} rules)</div>
      <div class="rules">
        {% for grp in model.by_rule %}
        <article class="rule {{ grp.impact_class }}">
          <div class="rule-header">
            <div class="rule-title">
              <span class="rule-id">{{ grp.id }}</span>
              <span class="badge badge-impact">{{ (grp.impact or 'unknown') | title }}</span>
              <span class="badge badge-count">{{ grp.count }} issue{{ 's' if grp.count != 1 else '' }}</span>
            </div>
            {% if grp.helpUrl %}
            <div class="rule-actions">
              <a class="badge badge-link" href="{{ grp.helpUrl }}" target="_blank" rel="noopener">Docs</a>
            </div>
            {% endif %}
          </div>

          {% if grp.description or grp.help or grp.tags %}
          <div class="rule-meta">
            {% if grp.description %}
            <p class="rule-desc">{{ grp.description }}</p>
            {% elif grp.help %}
            <p class="rule-desc">{{ grp.help }}</p>
            {% endif %}
            {% if grp.tags %}
            <div class="rule-tags">
              {% for tag in grp.tags %}
              <span class="rule-tag">{{ tag.replace('_', ' ').replace('.', ' › ') }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          {% endif %}

          <div class="occ-groups">
            {% for pg in grp.page_groups %}
            <section class="occ-group">
              <div class="occ-group-header">
                <div class="occ-header-left">
                  <span class="occ-page">{{ pg.label }}</span>
                  <div class="occ-links">
                    {% if pages_web_base and pg.source_file %}
                      <a class="occ-link" href="{{ pages_web_base }}/{{ pg.source_file }}" target="_blank" rel="noopener">Open local copy</a>
                    {% endif %}
                    {% if pg.url %}
                      {% set link_text = 'Open scanned URL (requires server)' if 'localhost' in pg.url or '127.0.0.1' in pg.url else 'Open scanned URL' %}
                      <a class="occ-link" href="{{ pg.url }}" target="_blank" rel="noopener">{{ link_text }}</a>
                    {% endif %}
                    {% set raw_json = None %}
                    {% if pg.occurrences and pg.occurrences[0].report_filename %}
                      {% set raw_json = results_web_base ~ '/' ~ pg.occurrences[0].report_filename %}
                    {% endif %}
                    {% if raw_json %}
                      <a class="occ-link" href="{{ raw_json }}" target="_blank" rel="noopener">Raw JSON</a>
                    {% endif %}
                  </div>
                </div>
                <span class="occ-count">{{ pg.total }} finding{{ 's' if pg.total != 1 else '' }}</span>
              </div>

              {% if pg.screenshot_filename %}
              <figure class="occ-screenshot">
                <img src="{{ results_web_base }}/{{ pg.screenshot_filename }}" alt="Screenshot showing {{ grp.id }} on {{ pg.label }}" loading="lazy">
                <figcaption>Captured during scan</figcaption>
              </figure>
              {% endif %}

              <div class="occ-list">
                {% for occ in pg.occurrences %}
                <details class="occ">
                  <summary>
                    <span class="occ-summary">
                      {% if occ.selector %}
                        <code>{{ occ.selector | e }}</code>
                      {% else %}
                        <span class="occ-missing">No selector provided</span>
                      {% endif %}
                    </span>
                    <span class="occ-pill">{{ loop.index }} / {{ pg.total }}</span>
                  </summary>
                  <div class="occ-body">
                    {% if occ.selector %}
                    <div class="occ-meta-row">
                      <span class="occ-label">Selector</span>
                      <span class="occ-value"><code>{{ occ.selector | e }}</code></span>
                    </div>
                    {% endif %}
                    {% if occ.html_snippet %}
                    <div class="snippet">
                      <div class="snippet-label">HTML Snippet</div>
                      <pre><code>{{ occ.html_snippet | e }}</code></pre>
                    </div>
                    {% endif %}
                    {% if occ.failure_summary %}
                    {% set fail_lines = occ.failure_summary.split('\\n') %}
                    {% if fail_lines %}
                    <div class="why">
                      <div class="snippet-label">Why It Fails</div>
                      <ul class="why-list">
                        {% for line in fail_lines %}
                          {% set text = line.strip() %}
                          {% if text %}
                          <li class="{{ 'why-lead' if loop.index == 1 else '' }}">{{ text | e }}</li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                    {% endif %}
                    {% endif %}
                  </div>
                </details>
                {% endfor %}
              </div>
            </section>
            {% endfor %}
          </div>
        </article>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <footer>
      <strong>a11y-scanner</strong> • Powered by <a href="https://github.com/dequelabs/axe-core" target="_blank" rel="noopener">axe-core</a> + <a href="https://playwright.dev" target="_blank" rel="noopener">Playwright</a>
    </footer>
  </div>
</body>
</html>
